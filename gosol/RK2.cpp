#include <cstdlib>
#include "RK2.h"

using namespace gosol;

//-----------------------------------------------------------------------------
RK2::RK2(ODE* ode)
//-----------------------------------------------------------------------------
{
  attach(ode);
}

//-----------------------------------------------------------------------------
RK2::~RK2 ()
//-----------------------------------------------------------------------------
{
  free(k1);
  free(tmp);
}

//-----------------------------------------------------------------------------
void  RK2:: attach(ODE* ode)
//-----------------------------------------------------------------------------
{
  this->ode = ode;
  k1  = static_cast<double*>(malloc(sizeof(double)*ode->size()));
  tmp = static_cast<double*>(malloc(sizeof(double)*ode->size()));
}


//-----------------------------------------------------------------------------
void RK2:: forward(double* y, double t, double dt) 
//-----------------------------------------------------------------------------
{
  ode->eval(y, t, k1);
  add(tmp, y, 0.5*dt, k1);
  ode->eval(tmp, t+0.5*dt, k1);

  for (int i=0; i < ode->size(); ++i)
    y[i] += dt*k1[i];
}


